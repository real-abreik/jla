<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JLA - Donation Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style type="text/css">
        body {
            color: #000;
            font-family: 'Montserrat', 'Arial', sans-serif;
            font-size: 16px;
            text-align: center;
            background-size: cover;
            background-color: black;
        }
        #table {
            width: 670px;
            position: relative;
        }
        .progressBar {
            width: 670px;
            position: relative;
            background: #000;
            overflow: hidden;
            height: 96px;
            text-align: left;
            color: #fff;
            font-size: 38px;
            border: 2px solid black;
        }
        .header, .footer {
            width: 670px;
            height: 48px;
            background: #000;
            color: #ff8c00;
            border: 2px solid black;
            position: relative;
        }
        .header {
            display: flex;
            align-items: center;
        }
        .headerLeft {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-left: 8px;
            width: 50%;
        }
        .headerLeft img {
            height: 36px;
        }
        .headerLeft span {
            font-size: 18px;
            font-weight: bold;
        }
        .headerRight {
            width: 50%;
            height: 100%;
            position: relative;
        }
        .teamProgressBar {
            width: 95%;
            height: 90%;
            background: #000;
            color: #fff;
            border: 2px solid #fff;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .teamProgressFilled {
            background-image: linear-gradient(-45deg,rgba(255,255,255,0.17) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.17) 50%,rgba(255,255,255,0.17) 75%,transparent 75%);
            background-size: 20px 20px;
            background-color: #ff8c00;
            height: 100%;
        }
        .teamRaised {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            z-index: 1;
        }
        .teamPercent {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: bold;
            z-index: 1;
        }
        .teamGoalText {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            z-index: 1;
        }
        .footer {
            position: fixed;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .footer img {
            position: absolute;
            height: 88px;
            bottom: 0;
            left: calc(50% + 110px);
            z-index: 1001;
            filter: brightness(0) saturate(100%) invert(56%) sepia(89%) saturate(1651%) hue-rotate(360deg) brightness(102%) contrast(101%);
        }
        .progressBarFilled {
            background-image: linear-gradient(-45deg,rgba(255,255,255,0.17) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.17) 50%,rgba(255,255,255,0.17) 75%,transparent 75%);
            background-size: 20px 20px;
            background-color: #c8025b;
            overflow: hidden;
            animation: thermo-progress-horz 1s 1 forwards ease-out;
            height: 100%;
            display: inline-block;
            text-align: center;
        }
        .highlight, .highlight .progressBarFilled {
            background-color: yellow;
        }
        .participantImg {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translate(0, -50%);
        }
        .participantName {
            position: absolute;
            top: 0;
            left: 106px;
            overflow: hidden;
            white-space: nowrap;
        }
        .participantProgress {
            position: absolute;
            bottom: 0;
            left: 106px;
        }
        .participantProgress.goalMet {
            color: lightgreen;
        }
        .participantHospitalImg {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translate(0, -50%);
        }
        #donationAlert {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #donationAlert .alertImgContainer {
            display: flex;
            gap: 30px;
            align-items: center;
            margin-bottom: 30px;
        }
        #donationAlert .alertImg {
            width: 300px;
            height: 300px;
            border-radius: 50%;
        }
        #donationAlert .alertHospitalContainer {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #donationAlert .alertHospitalImg {
            max-width: 250px;
            max-height: 250px;
        }
        #donationAlert .alertName {
            font-size: 72px;
            margin-bottom: 20px;
        }
        #donationAlert .alertAmount {
            font-size: 80px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 20px;
        }
        #donationAlert .alertProgressBar {
            width: 800px;
            height: 120px;
            background: #000;
            border: 3px solid #fff;
            position: relative;
            margin-bottom: 20px;
        }
        #donationAlert .alertProgressFilled {
            background-image: linear-gradient(-45deg,rgba(255,255,255,0.17) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.17) 50%,rgba(255,255,255,0.17) 75%,transparent 75%);
            background-size: 20px 20px;
            background-color: #c8025b;
            height: 100%;
        }
        #donationAlert .alertRaised {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
        }
        #donationAlert .alertPercent {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 56px;
            font-weight: bold;
        }
        #donationAlert .alertGoal {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
        }
        #donationAlert .alertDonor {
            font-size: 48px;
            margin-bottom: 15px;
        }
        #donationAlert .alertMessage {
            font-size: 36px;
            max-width: 900px;
            text-align: center;
        }
        #donationAlert .goalMetText {
            font-size: 64px;
            color: lightgreen;
            margin-bottom: 20px;
        }
        #donationAlert .alertSubtext {
            font-size: 48px;
            color: #fff;
            margin-top: 10px;
        }
        #splashScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #01061B;
            z-index: 999;
            justify-content: center;
            align-items: center;
        }
        #splashScreen img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div id="hospitalPreload" style="display:none;"></div>
    <div id="topRow" class="header" style="display:none;">
        <div class="headerLeft">
            <img src="images/team-logo.webp" alt="Team Logo">
            <span>Game Day 2025</span>
        </div>
        <div class="headerRight">
            <div class="teamProgressBar">
                <div class="teamProgressFilled"></div>
                <div class="teamRaised"></div>
                <div class="teamPercent"></div>
                <div class="teamGoalText"></div>
            </div>
        </div>
    </div>
    <div id="table" data-index="-1">
    </div>
    <div id="bottomRow" class="footer" style="display:none;">
        <span>Scan to join or donate</span>
        <img src="images/jla2025.svg" alt="QR Code">
    </div>
    </div>

    <div id="splashScreen">
        <img src="images/splash.png" alt="Splash">
    </div>

    <div id="donationAlert">
        <div class="alertImgContainer">
            <img class="alertImg">
            <div class="alertHospitalContainer">
                <img class="alertHospitalImg">
            </div>
        </div>
        <div class="alertName"></div>
        <div class="goalMetText">ðŸŽ‰ GOAL MET! ðŸŽ‰</div>
        <div class="alertProgressBar">
            <div class="alertProgressFilled"></div>
            <div class="alertRaised"></div>
            <div class="alertPercent"></div>
            <div class="alertGoal"></div>
        </div>
        <div class="alertAmount"></div>
        <div class="alertSubtext"></div>
        <div class="alertDonor"></div>
        <div class="alertMessage"></div>
    </div>

    <script type="text/template" id="row-template">
        <div class="progressBar">
            <div class="progressBarFilled"></div>
            <img class="participantHospitalImg" width="150">
            <img class="participantImg" width="100">
            <div class="participantName"></div>
            <div class="participantProgress"></div>
        </div>
    </script>

    <script type="text/javascript">
    const teamID = 69021;
    const rowWidth = 670;
    const origRowHeight = 100;
    const walkTotal = 3747;
    const allTimePrevious = 141282;
    let rowHeight = origRowHeight;

    let participants = [];
    let alertStack = [];
    let donationQueue = [];
    let showingAlert = false;
    let previousDonations = {};
    let teamGoal = 0;
    let teamTotal = 0;
    let lastMilestone = 0;
    let lastAllTimeMilestone = 0;
    let updateTimer = null;
    let showingSplash = false;

    function formatDollar(num) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(Math.floor(num));
    }

    function resize() {
        let ratio = Math.floor(((window.innerWidth - 10) / rowWidth) * 100);
        $('#topRow, #table, #bottomRow').css('zoom', '' + ratio + '%');
        rowHeight = origRowHeight * (ratio / 100);
    }

    function sortParticipants() {
        participants.sort((a, b) => {
            if (a.sumDonations > b.sumDonations) {
                return -1;
            } else if (a.sumDonations < b.sumDonations) {
                return 1;
            } else {
                return 0;
            }
        });
    }

    function findParticipant(id) {
        for (let i in participants) {
            if (participants[i].participantID == id) {
                return participants[i];
            }
        }
        location.reload();
    }

    function getHospital(participantId) {
        return new Promise((resolve) => {
            let url = "https://www.extra-life.org/index.cfm?fuseaction=donorDrive.participant&participantID=" + participantId + "&r=" + Math.random();
            url = "https://corsproxy.io/?" + encodeURIComponent(url);
            $.ajax({
                url: url,
                cache: false,
                dataType: "html",
                participantId: participantId,
                success: function(response) {
                    $html = $(response);
                    let hospitalImg = $html.find('#hospitallogobox img').attr('src');
                    const savedImages = {
                        'choc': 'https://donordrivecontent.com/helpmakemiracles/images/$hospitals$/CHOCHospital-5049.jpg',
                        'chla': 'https://donordrivecontent.com/helpmakemiracles/images/$hospitals$/ChildrensHospitalLosAngeles-5037.jpg',
                        'cmnh': 'https://images.childrensmiraclenetwork.org/cmnhospitals/CMNHospitalslogoVert.jpg',
                        'corewell': 'https://donordrivecontent.com/helpmakemiracles/images/$hospitals$/CorewellHealthChildrens-5018.jpg',
                        'gillette': 'https://donordrivecontent.com/helpmakemiracles/images/$hospitals$/GilletteChildrens-5068.jpg'
                    };
                    Object.keys(savedImages).forEach((key) => {
                        if (savedImages[key] == hospitalImg) {
                            hospitalImg = 'images/' + key + '.jpg';
                        }
                    });
                    let index = participants.findIndex((participant) => participant.participantID == this.participantId);
                    participants[index].hospitalImg = hospitalImg;
                    let img = new Image();
                    img.onload = () => resolve();
                    img.onerror = () => resolve();
                    img.src = hospitalImg;
                },
                error: function() {
                    resolve();
                }
            });
        });
    }

    function updateTable() {
        if (showingAlert) return;
        if (showingSplash) return;
        let $table = $('#table');
        $table.html('');
        $('#topRow').show();
        let index = parseInt($table.attr('data-index'));
        let fit = Math.floor((window.innerHeight - rowHeight) / rowHeight);
        let showOne = false;
        let lastIndex = index;
        for (let i = index + 1; i <= index + fit; i++) {
            let participant = participants[i];
            if (typeof participant === 'undefined') {
                break;
            }
            lastIndex = i;
            if (participant.sumDonations < 1) {
                break;
            }
            addRow(participant, i + 1);
            showOne = true;
        }
        $('#bottomRow').show();
        $table.attr('data-index', lastIndex);
        if (!showOne) {
            $table.attr('data-index', -1);
            updateTable();
            return;
        }
        if (lastIndex >= participants.length - 1 || (lastIndex < participants.length - 1 && participants[lastIndex + 1].sumDonations < 1)) {
            scheduleNextUpdate(true);
        } else {
            scheduleNextUpdate(false);
        }
    }

    function scheduleNextUpdate(showSplash) {
        clearTimeout(updateTimer);
        updateTimer = setTimeout(() => {
            if (showingAlert) {
                scheduleNextUpdate(showSplash);
                return;
            }
            // if (showSplash) {
            //     showSplashScreen();
            // } else {
                updateTable();
            // }
        }, 30000);
    }

    function showSplashScreen() {
        if (showingAlert) {
            scheduleNextUpdate(true);
            return;
        }
        showingSplash = true;
        $('#topRow, #table, #bottomRow').hide();
        $('#splashScreen').css('display', 'flex');
        clearTimeout(updateTimer);
        updateTimer = setTimeout(() => {
            if (showingAlert) {
                updateTimer = setTimeout(() => showSplashScreen(), 1000);
                return;
            }
            $('#splashScreen').hide();
            $('#table').show().attr('data-index', -1);
            showingSplash = false;
            updateTable();
        }, 30000);
    }

    function addRow(participant, rank) {
        let template = $('#row-template').html();
        let $el = $(template);
        let walkTotal = 0;
        let elTotal = parseFloat(participant.sumDonations);
        let totalRaised = walkTotal + elTotal;
        if (totalRaised <= 0) {
            return;
        }
        let fundraisingGoal = participant.fundraisingGoal;
        let goalPercent = Math.floor((totalRaised / fundraisingGoal) * 100);
        $el.attr('id', 'row-' + participant.participantID);
        $el.find('.progressBarFilled').css('width', '' + goalPercent + '%');
        $el.find('.participantImg').attr('src', participant.avatarImageURL);
        $el.find('.participantName').html('' + participant.displayName);
        $el.find('.participantProgress').html('' + formatDollar(participant.sumDonations) + ' of ' + formatDollar(participant.fundraisingGoal));
        if (participant.sumDonations >= participant.fundraisingGoal) {
            $el.find('.participantProgress').addClass('goalMet');
        }
        if (participant.hospitalImg && participant.displayName.length < 20) {
            $el.find('.participantHospitalImg').attr('src', participant.hospitalImg);
        } else {
            $el.find('.participantHospitalImg').remove();
        }
        $('#table').append($el);

        let alertIndex = alertStack.indexOf(participant.participantID);
        if (alertIndex >= 0) {
            alertStack.splice(alertIndex, 1);
            rowBlink(participant.participantID);
        }
    }

    function rowBlink(id) {
        $el = $('#row-' + id);
        $el.addClass('highlight');
        setTimeout(($el) => {
            $el.removeClass('highlight');
        }, 200, $el);
        for (let i = 1; i < 5; i++) {
            setTimeout(($el) => {
                $el.addClass('highlight');
            }, 400 * i, $el);
            setTimeout(($el) => {
                $el.removeClass('highlight');
            }, (400 * i) + 200, $el);
        }
    }

    function showDonationAlert(alert) {
        clearTimeout(updateTimer);
        showingAlert = true;
        $('#topRow, #table, #bottomRow').hide();
        $('#splashScreen').hide();
        showingSplash = false;
        let $alert = $('#donationAlert');
        if (alert.isTeam || alert.isTeamGoal || alert.isAllTime) {
            $alert.find('.alertImg').attr('src', alert.avatarImageURL).css('border-radius', '0');
            $alert.find('.alertHospitalContainer').hide();
            $alert.find('.alertDonor').hide();
            $alert.find('.alertMessage').hide();
            if (alert.isAllTime) {
                $alert.find('.alertProgressBar').hide();
                $alert.find('.alertAmount').text(formatDollar(alert.sumDonations)).show();
                $alert.find('.alertSubtext').text('raised since 2010').show();
            } else {
                $alert.find('.alertProgressBar').show();
                $alert.find('.alertSubtext').hide();
                if (alert.milestone) {
                    $alert.find('.alertAmount').text(formatDollar(alert.milestone) + '+').show();
                } else {
                    $alert.find('.alertAmount').hide();
                }
            }
        } else {
            $alert.find('.alertImg').attr('src', alert.avatarImageURL).css('border-radius', '50%');
            $alert.find('.alertProgressBar').show();
            $alert.find('.alertSubtext').hide();
            if (alert.hospitalImg) {
                $alert.find('.alertHospitalImg').attr('src', alert.hospitalImg);
                $alert.find('.alertHospitalContainer').show();
            } else {
                $alert.find('.alertHospitalContainer').hide();
            }
            if (alert.donationAmount) {
                $alert.find('.alertAmount').text(formatDollar(alert.donationAmount)).show();
            } else {
                $alert.find('.alertAmount').hide();
            }
            if (alert.donorName) {
                $alert.find('.alertDonor').text('From: ' + alert.donorName).show();
            } else {
                $alert.find('.alertDonor').hide();
            }
            if (alert.message) {
                $alert.find('.alertMessage').text(alert.message).show();
            } else {
                $alert.find('.alertMessage').hide();
            }
        }
        $alert.find('.alertName').text(alert.displayName);
        if (!alert.isAllTime) {
            let percent = Math.min(100, Math.floor((alert.sumDonations / alert.fundraisingGoal) * 100));
            $alert.find('.alertProgressFilled').css('width', percent + '%');
            $alert.find('.alertRaised').text(formatDollar(alert.sumDonations));
            $alert.find('.alertPercent').text(percent + '%');
            $alert.find('.alertGoal').text(formatDollar(alert.fundraisingGoal));
        }
        if (alert.isTeamGoal || (!alert.isAllTime && alert.sumDonations >= alert.fundraisingGoal)) {
            $alert.find('.goalMetText').show();
        } else {
            $alert.find('.goalMetText').hide();
        }
        $alert.css('display', 'flex');
        let duration = 60000;
        if (alert.donationAmount < 10 || (alert.donationAmount < 100 && donationQueue.length >= 5)) {
            duration = 30000;
        }
        setTimeout(() => {
            $alert.hide();
            showingAlert = false;
            if (donationQueue.length > 0) {
                processQueue();
            } else {
                $('#table').show();
                updateTable();
            }
        }, duration);
    }

    function processQueue() {
        if (!showingAlert && donationQueue.length > 0) {
            showDonationAlert(donationQueue.shift());
        }
    }

    window.testAlert = function(amount = 50) {
        if (participants.length > 0) {
            let p = participants[0];
            donationQueue.push({
                participantID: p.participantID,
                displayName: p.displayName,
                avatarImageURL: p.avatarImageURL,
                sumDonations: p.sumDonations,
                fundraisingGoal: p.fundraisingGoal,
                hospitalImg: p.hospitalImg || null,
                donationAmount: amount,
                donorName: 'Test Donor',
                message: 'This is a test donation message!'
            });
            processQueue();
        }
    };

    window.testTeamMilestone = function(milestone = 5000) {
        donationQueue.push({
            isTeam: true,
            displayName: 'TEAM MILESTONE!',
            avatarImageURL: 'images/team-logo.webp',
            sumDonations: teamTotal + walkTotal,
            fundraisingGoal: teamGoal,
            milestone: milestone
        });
        processQueue();
    };

    window.testTeamGoal = function() {
        donationQueue.push({
            isTeamGoal: true,
            displayName: 'TEAM GOAL MET!',
            avatarImageURL: 'images/team-logo.webp',
            sumDonations: teamGoal,
            fundraisingGoal: teamGoal
        });
        processQueue();
    };

    window.testAllTimeMilestone = function(milestone = 150000) {
        donationQueue.push({
            isAllTime: true,
            displayName: 'ALL-TIME MILESTONE!',
            avatarImageURL: 'images/team-logo.webp',
            sumDonations: teamTotal + walkTotal + allTimePrevious,
            fundraisingGoal: teamGoal,
            milestone: milestone
        });
        processQueue();
    };

    function checkNewDonations() {
        participants.forEach(p => {
            let prevAmount = previousDonations[p.participantID] || 0;
            if (p.sumDonations > prevAmount && prevAmount > 0) {
                getDonationDetails(p.participantID, p);
            }
            previousDonations[p.participantID] = p.sumDonations;
        });
    }

    function getDonationDetails(participantId, participant) {
        $.ajax({
            url: "https://www.extra-life.org/api/1.3/participants/" + participantId + "/donations?limit=1&offset=0&_=" + new Date().getTime(),
            dataType: "json",
            success: function(response) {
                if (response.length > 0) {
                    let donation = response[0];
                    donationQueue.push({
                        participantID: participant.participantID,
                        displayName: participant.displayName,
                        avatarImageURL: participant.avatarImageURL,
                        sumDonations: participant.sumDonations,
                        fundraisingGoal: participant.fundraisingGoal,
                        hospitalImg: participant.hospitalImg || null,
                        donationAmount: donation.amount || null,
                        donorName: donation.displayName !== 'Anonymous' ? donation.displayName : null,
                        message: donation.message || null
                    });
                    processQueue();
                }
            }
        });
    }

    function checkTeamMilestones() {
        let total = teamTotal + walkTotal;
        let currentMilestone = Math.floor(total / 1000) * 1000;
        if (currentMilestone > lastMilestone && lastMilestone > 0) {
            donationQueue.push({
                isTeam: true,
                displayName: 'TEAM MILESTONE!',
                avatarImageURL: 'images/team-logo.webp',
                sumDonations: total,
                fundraisingGoal: teamGoal,
                milestone: currentMilestone
            });
            processQueue();
        }
        lastMilestone = currentMilestone;
        let allTimeTotal = total + allTimePrevious;
        let currentAllTimeMilestone = Math.floor(allTimeTotal / 10000) * 10000;
        if (currentAllTimeMilestone > lastAllTimeMilestone && lastAllTimeMilestone > 0) {
            donationQueue.push({
                isAllTime: true,
                displayName: 'ALL-TIME MILESTONE!',
                avatarImageURL: 'images/team-logo.webp',
                sumDonations: allTimeTotal,
                fundraisingGoal: teamGoal,
                milestone: currentAllTimeMilestone
            });
            processQueue();
        }
        lastAllTimeMilestone = currentAllTimeMilestone;
        if (total >= teamGoal && teamGoal > 0) {
            let goalAlreadyQueued = donationQueue.some(item => item.isTeamGoal);
            if (!goalAlreadyQueued) {
                donationQueue.push({
                    isTeamGoal: true,
                    displayName: 'TEAM GOAL MET!',
                    avatarImageURL: 'images/team-logo.webp',
                    sumDonations: total,
                    fundraisingGoal: teamGoal
                });
                processQueue();
            }
        }
    }

    function updateTeamProgress() {
        let total = teamTotal + walkTotal;
        let percent = Math.min(100, Math.floor((total / teamGoal) * 100));
        $('.teamProgressFilled').css('width', percent + '%');
        $('.teamRaised').text(formatDollar(total));
        $('.teamPercent').text(percent + '%');
        $('.teamGoalText').text(formatDollar(teamGoal));
    }

    function getTeamInfo() {
        $.ajax({
            url: "https://www.extra-life.org/api/1.3/teams/" + teamID + "?_=" + new Date().getTime(),
            dataType: "json",
            success: function(response) {
                teamGoal = response.fundraisingGoal;
                teamTotal = response.sumDonations;
                if (lastMilestone === 0) {
                    lastMilestone = Math.floor((teamTotal + walkTotal) / 1000) * 1000;
                    lastAllTimeMilestone = Math.floor((teamTotal + walkTotal + allTimePrevious) / 10000) * 10000;
                }
                updateTeamProgress();
                checkTeamMilestones();
            }
        });
    }

    function getParticipants() {
        $.ajax({
            url: "https://www.extra-life.org/api/1.3/teams/" + teamID + "/participants?limit=80&offset=0&orderBy=sumDonations%20DESC%2C%20displayName%20ASC",
            cache: false,
            dataType: "json",
            success: function(response) {
                response.forEach((newParticipant) => {
                    oldParticipant = findParticipant(newParticipant.participantID);
                    if (alertStack.indexOf(newParticipant.participantID) < 0 && newParticipant.fundraisingGoal > oldParticipant.fundraisingGoal) {
                        alertStack.push(newParticipant.participantID);
                    }
                    if (oldParticipant.hospitalImg) {
                        newParticipant.hospitalImg = oldParticipant.hospitalImg;
                    }
                });
                participants = response;
                teamTotal = participants.reduce((sum, p) => sum + p.sumDonations, 0);
                updateTeamProgress();
                checkTeamMilestones();
                checkNewDonations();
            }
        });
    }

    function initParticipants() {
        $.ajax({
            url: "https://www.extra-life.org/api/1.3/teams/" + teamID + "/participants?limit=80&offset=0&orderBy=sumDonations%20DESC%2C%20displayName%20ASC",
            cache: false,
            dataType: "json",
            success: function(response) {
                participants = response;
                sortParticipants();
                let hospitalPromises = [];
                participants.forEach((participant) => {
                    previousDonations[participant.participantID] = participant.sumDonations;
                    hospitalPromises.push(getHospital(participant.participantID));
                    let img = new Image();
                    img.src = participant.avatarImageURL;
                });
                Promise.all(hospitalPromises).then(() => {
                    console.log('participants');
                    console.log(participants);
                    getTeamInfo();
                    setInterval(getParticipants, 60000);
                    setInterval(getTeamInfo, 300000);
                    updateTable();
                });
            }
        });
    }

    $(document).ready(function() {
        resize();

        setInterval(function() {
            location.reload();
        }, 3600000);

        addEventListener('resize', (event) => {
            resize();
        });
        initParticipants();
    });
    </script>
</body>